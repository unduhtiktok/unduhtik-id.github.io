<script>
    async function processVideo() {
        const url = document.getElementById('urlInput').value;
        if (!url) return alert("Tempel link TikTok dulu!");

        document.getElementById('loader').classList.remove('hidden');
        document.getElementById('result').classList.add('hidden');

        try {
            const res = await fetch(`https://www.tikwm.com/api/?url=${encodeURIComponent(url)}`);
            const data = await res.json();

            if (data.code === 0) {
                document.getElementById('videoThumb').src = data.data.cover;
                
                // Gunakan Smartlink yang sudah diatur ke 'Mainstream'
                const smartLink = 'https://www.effectivegatecpm.com/bvurraahp?key=0ceb5e7b8083bb7119327d38a80220fc'; 
                const videoLink = data.data.play;

                const startAdTimer = (seconds) => {
                    // 1. Buka iklan di tab baru
                    window.open(smartLink, '_blank');
                    
                    // 2. Munculkan Timer "Watch Ads" di halaman download
                    let timeLeft = seconds;
                    const statusBox = document.getElementById('adStatus');
                    statusBox.classList.remove('hidden');
                    statusBox.innerHTML = `Reward dalam ${timeLeft} detik...`;

                    const countdown = setInterval(() => {
                        timeLeft--;
                        statusBox.innerHTML = `Reward dalam ${timeLeft} detik...`;
                        
                        if (timeLeft <= 0) {
                            clearInterval(countdown);
                            // 3. Download otomatis dimulai sendiri
                            window.location.href = videoLink; 
                            statusBox.innerHTML = "Download dimulai otomatis!";
                        }
                    }, 1000);
                };

                document.getElementById('btnVideo').onclick = () => startAdTimer(5);
                document.getElementById('btnVideoHD').onclick = () => startAdTimer(15);

                document.getElementById('result').classList.remove('hidden');
            }
        } catch (e) {
            alert("Gagal memproses.");
        } finally {
            document.getElementById('loader').classList.add('hidden');
        }
    }
</script>
